<html>

<head>
    <script src="https://js.leapmotion.com/leap-0.6.4.min.js"></script>
</head>

<body>
    <h1>그림 기억하기</h1>
    <!-- 이미지를 담을 테이블 생성 -->
    <table id="pztable">
        <tr>
            <td><img src="" id="pz0"></td>
            <td><img src="" id="pz1"></td>
            <td><img src="" id="pz2"></td>
        </tr>
        <tr>
            <td><img src="" id="pz3"></td>
            <td><img src="" id="pz4"></td>
            <td><img src="" id="pz5"></td>
        </tr>
        <tr>
            <td><img src="" id="pz6"></td>
            <td><img src="" id="pz7"></td>
            <td><img src="" id="pz8"></td>
        </tr>
    </table>

    <div id="container">
        <img src="" id="qz">
        <span id="quiz"></span>
        <p id="answer"></p>
    </div>
</body>
<style>
    body {
        position: relative;
    }

    table {
        /* border: solid 1px; */
        border-collapse: collapse;
        margin: 0 auto;
    }

    /* tr td{
        border: solid 1px;
    } */

    #container {
        position: absolute;
        top: 20%;
        left: 50%;
        width: 100%;
        margin-left: -50%;

        display: flex;
        justify-content: center;
        align-items: center;
    }

    #quiz {
        font-size: 30px;
    }
</style>
<script>
    var game = 0;
    start();

    // 실행
    function start() {   
        game++;
        console.log("start :" , game); 
      
        setTimeout(img,1000);
        // while (sw){
        //     if(game > 5){
        //         sw = false;
        //         break;
        //     } else {
        //         img();
        //         break;
        //     }
        // }
    }


    // 이미지 생성
    function img() {
        console.log("img : ", game);
        var puzzle = ['img/mouse.png', 'img/rabbit.png', 'img/snake.png', 'img/tiger.png'];
        var check = [0, 0, 0, 0];
        var draw = 0;
        
        // for(var i = 0; i < 9; i++) {
        //     var ran = Math.floor(Math.random() * puzzle.length);
        //     if(check[ran] < 5) {
        //         document.getElementById("pz" + i + "").src = puzzle[ran];
        //         check[ran]++;
        //     } else {

        //     }
        // }

        // setTimeout(question, 5000, puzzle[ran], check[ran]);
        document.getElementById('pztable').style.visibility = "visibility";
        while (draw < 9) {
            var ran = Math.floor(Math.random() * puzzle.length);
            if (check[ran] < 5) {
               
                document.getElementById("pz" + draw + "").src = puzzle[ran];
                check[ran]++;
                draw++;
                if (draw == 9) {
                    break;
                   
                    // question(puzzle[ran], check[ran]);
                }
            }
            
        }
        console.log(check);
        setTimeout(question, 5000, puzzle[ran], check[ran]);
    }


    // 문제
    function question(ran, cran) {
        console.log("question : ", game);
        //console.log("question");
        //console.log("question : " ,cran);
        // 그림 지우기
        document.getElementById('pztable').style.visibility = "hidden";

        // 질문
        // setTimeout(() => {
        //     //console.log("question");
        //     document.getElementById('qz').src = ran;
        //     document.getElementById('quiz').innerHTML = "는 몇 마리 입니까?";
        // }, 1000);
        document.getElementById('qz').src = ran;
        document.getElementById('quiz').innerHTML = "는 몇 마리 입니까?";

        setTimeout(leap, 1000, cran);
        
        // leap(cran);
    }


    // leapmotion 손가락
    function leap(cran) {
        
            console.log("leap : ", game);
            //console.log("leap : " ,cran);
            var count = [0, 0, 0, 0, 0, 0];
            Leap.loop(function (frame) {
                if (frame.hands.length > 0) {
                    var hand = frame.hands[0];
                    var fingers = hand.fingers[0];

                    var extendedFingers = 0;

                    for (var f = 0; f < hand.fingers.length; f++) {
                        var finger = hand.fingers[f];
                        if (finger.extended) extendedFingers++;
                    }
                    //console.log("extendedFingers", extendedFingers);
                    count[extendedFingers]++;
                    //console.log("count : ", count);

                    for (var i = 0; i < count.length; i++) {
                        if (count[i] > 100) {
                            inspection(i, cran);
                        }
                    }
                }
            });
        

    }


    // 정답확인
    function inspection(i, cran) {
        console.log("inspection : ", game);
        //console.log("cran : ", cran);
        if (i == cran) {
            document.getElementById('answer').innerHTML = "정답입니다!";
    
            setTimeout(start, 2000);
            // start();
            
        } else {
            document.getElementById('answer').innerHTML = "틀렸습니다!";
           
            setTimeout(start, 2000);
            

        }
    }

    function reset() {
        console.log("reset : ", game);
        document.getElementById('qz').src = "";
        document.getElementById('quiz').innerHTML = "";
        document.getElementById('answer').innerHTML = "";
        document.getElementById('pztable').style.visibility = "visibility";


        if (game < 5) {
            setTimeout(start, 2000);
        }    
    }
</script>

</html>